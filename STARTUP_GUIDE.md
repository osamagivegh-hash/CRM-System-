# 🚀 دليل تشغيل نظام CRM

## ⚠️ **حل مشكلة Port المشغول:**

### **المشكلة:**
```
Error: listen EADDRINUSE: address already in use :::5000
```

### **الحل الشامل:**

#### **1. إيقاف جميع العمليات:**
```bash
taskkill /f /im node.exe
taskkill /f /im nodemon.exe
```

#### **2. التحقق من تحرير المنفذ:**
```bash
netstat -ano | findstr :5000
# يجب أن تكون النتيجة فارغة
```

#### **3. تشغيل التطبيق:**
```bash
# Terminal 1 - Backend
cd backend
npm run dev

# Terminal 2 - Frontend  
cd frontend
npm start
```

---

## 🔧 **إصلاح CORS للـ Port 3001:**

### ✅ **تم تحديث Backend:**
```javascript
// في backend/server.js
app.use(cors({
  origin: ['http://localhost:3000', 'http://localhost:3001'], // ✅ يدعم كلا المنفذين
  credentials: true
}));
```

### ✅ **Frontend يعمل على أي منفذ:**
- **Port 3000:** `npm start`
- **Port 3001:** `PORT=3001 npm start`

---

## 🎯 **التشغيل الصحيح:**

### **الطريقة الموصى بها:**

#### **Terminal 1 (Backend):**
```bash
cd C:\Users\alrya\Desktop\مشاريعي\CRM\backend
npm run dev
```
**يجب أن ترى:**
```
Server running in development mode on port 5000
MongoDB Connected: ac-mtgvpu1-shard-00-02.npzs81o.mongodb.net
```

#### **Terminal 2 (Frontend):**
```bash
cd C:\Users\alrya\Desktop\مشاريعي\CRM\frontend
npm start
```
**سيفتح على:** http://localhost:3000 أو http://localhost:3001

---

## 🔍 **التحقق من عمل النظام:**

### **1. Backend يعمل:**
- **اذهب لـ:** http://localhost:5000/api/health
- **يجب أن ترى:** `{"success": true, "message": "CRM API is running"}`

### **2. Frontend يعمل:**
- **اذهب لـ:** http://localhost:3000 أو http://localhost:3001
- **يجب أن ترى:** صفحة تسجيل الدخول

### **3. لا توجد أخطاء CORS:**
- **افتح Console (F12)**
- **لا يجب أن ترى:** رسائل خطأ CORS
- **يجب أن ترى:** API calls ناجحة

---

## 🧪 **اختبار النظام الكامل:**

### **1. تسجيل الدخول:**
```
البريد: admin@crm.com
كلمة المرور: SuperAdmin123!
```

### **2. اختبار Dashboard:**
- **يجب أن ترى:** إحصائيات العملاء والعملاء المحتملين
- **Sales Funnel:** توزيع العملاء المحتملين
- **النشاط الحديث:** أرقام من البيانات التجريبية

### **3. اختبار العملاء:**
1. **اذهب لـ:** `/clients`
2. **ستجد:** 6 عملاء من البيانات التجريبية
3. **اضغط على "Alice Johnson"** → صفحة التفاصيل
4. **اضغط "تعديل البيانات"** → نموذج مملوء
5. **غيّر الاسم** واحفظ → سيتم التحديث

### **4. اختبار العملاء المحتملين:**
1. **اذهب لـ:** `/leads`
2. **ستجد:** 8 عملاء محتملين
3. **اضغط على أي اسم** → صفحة التفاصيل
4. **اضغط "تعديل البيانات"** → نموذج مملوء بالحالة والأولوية
5. **غيّر الحالة** من "new" إلى "qualified" → احفظ

### **5. اختبار الشركات:**
1. **اذهب لـ:** `/companies`
2. **ستجد:** شركتين (TechStart Solutions, Global Marketing Inc)
3. **اضغط على اسم الشركة** → صفحة التفاصيل
4. **اضغط "تعديل البيانات"** → نموذج مملوء
5. **عدّل اسم الشركة** واحفظ

### **6. اختبار المستخدمين:**
1. **اذهب لـ:** `/users`
2. **ستجد:** 9 مستخدمين (1 مدير نظام + 8 مستخدمين للشركتين)
3. **اضغط على اسم أي مستخدم** → نموذج التعديل
4. **ستجد النموذج مملوءاً** بالاسم والبريد والدور
5. **غيّر الدور** واحفظ

---

## 🎉 **النتيجة المتوقعة:**

### ✅ **جميع الوظائف تعمل:**
- ✅ **الأسماء قابلة للنقر** وتنقلك للتفاصيل
- ✅ **أزرار التعديل واضحة** ومرئية
- ✅ **نماذج التعديل مملوءة** بالبيانات الحالية
- ✅ **نماذج الإضافة فارغة** للسجلات الجديدة
- ✅ **التحديث يعمل** ويحفظ التغييرات
- ✅ **العلاقات صحيحة** بين العملاء والشركات
- ✅ **لا توجد أخطاء CORS**

### 🎯 **إذا واجهت أي مشكلة:**
1. **أوقف جميع العمليات:** `taskkill /f /im node.exe`
2. **أعد تشغيل Backend:** `cd backend && npm run dev`
3. **أعد تشغيل Frontend:** `cd frontend && npm start`
4. **امسح cache المتصفح:** Ctrl+Shift+R

**🚀 النظام جاهز للاستخدام الكامل!**












